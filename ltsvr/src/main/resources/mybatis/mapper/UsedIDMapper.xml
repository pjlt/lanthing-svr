<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.lanthing.svr.dao.IUsedIDDao">

    <update id="createTable">
        CREATE TABLE IF NOT EXISTS used_device_ids2 (
            "id"	        INTEGER NOT NULL UNIQUE,
            "createdAt"	DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
            "updatedAt"	DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
            "deviceID"     INTEGER,
            "cookie"        TEXT,
            PRIMARY KEY("id" AUTOINCREMENT)
        );
        CREATE TRIGGER IF NOT EXISTS UpdateTimestamp
            AFTER UPDATE
            ON used_device_ids2
        BEGIN
            UPDATE used_device_ids2 SET updatedAt = CURRENT_TIMESTAMP WHERE id=OLD.id;
        END;
    </update>
    <select id="queryByDeviceID" parameterType="long" resultType="cn.lanthing.svr.entity.UsedIDEntity">
        SELECT * FROM used_device_ids2 WHERE deviceID = #{deviceID}
    </select>
    <insert id="addDeviceID">
        INSERT INTO used_device_ids2(deviceID, cookie) values (#{deviceID}, #{cookie})
    </insert>
    <update id="updateCookie">
        UPDATE used_device_ids2 SET cookie = #{cookie} WHERE deviceID = #{deviceID}
    </update>

</mapper>